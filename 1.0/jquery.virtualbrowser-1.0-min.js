// encoding: utf-8
(function(d,p){d.fn.detach=d.fn.detach||function(){return this.each(function(){var a=this.parentNode;a&&a.nodeType==1&&a.removeChild(this)})};var t=document.location,l='virtualBrowser',u='VBbeforeload',v='VBload',w='VBloaded',c='replace',x=/^(https?:)?\/\//,y={'load':function(e){var f=typeof e!='string'?d(e):p,j=d(this),m=j.data(l).cfg,k=d.Event(u),z=m.loadmsgMode,g={elm:f};if(f){e=f.attr('href');e=e===p?f.attr('action'):e}e=g.url=e===''?t.href:e;if(e){j.trigger(k,g);if(!k.passThrough&&((k.passThrough===p&&f&&f[0].target&&f[0].target!=window.name)||(/^([a-z]{3,12}:|\/\/)/i.test(e)&&!e.toLowerCase()[c](x,'').indexOf(t.href.toLowerCase()[c](x,'').split('/')[0])==0))){k.passThrough=true}k.passThrough&&k.preventDefault();if(!k.isDefaultPrevented()){var r=m.params,A=g.noCache,B;if(f&&f.is('form')){r=f.serialize()+'&'+r;B=f.attr('method')||'GET'}d.ajax({url:g.url.split('#')[0],data:r,type:B,cache:A!==p?A:!m.noCache,complete:function(a){var h=g.url.split('#')[0],n=h[c](/([^?]*\/)?(.*)/,'$2'),q=h.split('?')[0][c](/(.*\/)?.*/,'$1'),i=/\?/.test(h),b=a.responseText;i&&(b=b[c](/(['"])\?/gi,'$1¨<<`>>'));b=b[c](/(<[^>]+ (href|src|action)=["'])(["'#¨])/gi,'$1'+n+'$3');i&&(b=b[c](/(['"])¨<<`>>/gi,'$1?')[c](/¨<<`>>/gi,'&amp;'));b=b[c](/http:\/\//gi,'^<<`>>')[c](/https:\/\//gi,'`<<`>>')[c](/(<[^>]+ (href|src|action)=["'])([^\/`\^])/gi,'$1'+q+'$3')[c](/\^<<`>>/g,'http://')[c](/\^<<`>>/g,'http://')[c](/`<<`>>/g,'https://');g.result=b;var o=d.Event(v);j.trigger(o,g);if(!o.isDefaultPrevented()){m.loadmsgElm.detach();j.empty().append(g.resultDOM||d.getResultBody(g.result)[0].childNodes).trigger(w,{url:g.url,elm:g.elm}).find('[href]').data(l+'Elm',j).bind('click',C).end().find('form').data(l+'Elm',j).bind('submit',C)}}});if(z&&z!='none'){m.loadmsgMode=='replace'&&j.empty();j.append(m.loadmsgElm)}}}return k}},C=function(a){if(!a.isDefaultPrevented()){var h=this,n=d(h).data(l+'Elm')||this;bfloadEv=y['load'].call(n,h);bfloadEv.isPropagationStopped()&&a.stopPropagation();!bfloadEv.passThrough&&a.preventDefault()}},s=d.fn[l]=function(a,h){var n=typeof a=='string';if(n){var q=y[a];q&&this.each(function(){q.apply(this,[].concat(h))})}else{a=d.extend({loadmsgMode:'none'},a||{});h&&(a.url=h);var i=this,b=a.loadmsgElm||'<div class="loading" />',o=(s.i18n[i.closest('*[lang]').attr('lang')]||{}).loading||s.i18n.en.loading;if(b.charAt){b=b.replace(/%\{msg\}/g,o)}b=a.loadmsgElm=d(b);if(!b.text()){b.append(o)}i.data(l,{cfg:a});a.onLoad&&i.bind(v,a.onLoad);a.onLoaded&&i.bind(w,a.onLoaded);a.onBeforeload&&i.bind(u,a.onBeforeload);a.params=typeof a.params=='string'?a.params:d.param(a.params||{});a.url&&i[l]('load',a.url)}return this};s.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);
