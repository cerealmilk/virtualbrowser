// encoding: utf-8
(function(d,o){d.fn.detach=d.fn.detach||function(){return this.each(function(){var a=this.parentNode;a&&a.nodeType==1&&a.removeChild(this)})};var w=document.location,s='isDefaultPrevented',p='stopPropagation',l='virtualBrowser',x='VBbeforeload',y='VBload',z='VBloaded',e='replace',A=/^(https?:)?\/\//,B={'load':function(c){var f=typeof c!='string'?d(c):o,k=d(this),m=k.data(l).cfg,i=d.Event(x),q,t,C=m.loadmsgMode,g={elm:f};if(f){c=f.attr('href');c=c===o?f.attr('action'):c}c=g.url=c===''?w.href:c;if(c){i[p]();k.trigger(i,g);if(!i.passThrough&&((i.passThrough===o&&f&&f[0].target&&f[0].target!=window.name)||(/^([a-z]{3,12}:|\/\/)/i.test(c)&&!c.toLowerCase()[e](A,'').indexOf(w.href.toLowerCase()[e](A,'').split('/')[0])==0))){i.passThrough=true}i.passThrough&&i.preventDefault();if(!i[s]()){var u=m.params,D=g.noCache,E;if(f&&f.is('form')){u=f.serialize()+'&'+u;E=f.attr('method')||'GET'}d.ajax({url:g.url.split('#')[0],data:u,type:E,cache:D!==o?D:!m.noCache,complete:function(a){var h=g.url.split('#')[0],n=h[e](/([^?]*\/)?(.*)/,'$2'),r=h.split('?')[0][e](/(.*\/)?.*/,'$1'),j=/\?/.test(h),b=a.responseText;j&&(b=b[e](/(['"])\?/gi,'$1¨<<`>>'));b=b[e](/(<[^>]+ (href|src|action)=["'])(["'#¨])/gi,'$1'+n+'$3');j&&(b=b[e](/(['"])¨<<`>>/gi,'$1?')[e](/¨<<`>>/gi,'&amp;'));b=b[e](/http:\/\//gi,'^<<`>>')[e](/https:\/\//gi,'`<<`>>')[e](/(<[^>]+ (href|src|action)=["'])([^\/`\^])/gi,'$1'+r+'$3')[e](/\^<<`>>/g,'http://')[e](/\^<<`>>/g,'http://')[e](/`<<`>>/g,'https://');g.result=b;q=d.Event(y);q[p]();k.trigger(q,g);if(!q[s]()){t=d.Event(z);t[p]();m.loadmsgElm.detach();k.empty().append(g.resultDOM||d.getResultBody(g.result)[0].childNodes).trigger(t,{url:g.url,elm:g.elm}).find('[href]').data(l+'Elm',k).bind('click',F).end().find('form').data(l+'Elm',k).bind('submit',F)}}});if(C&&C!='none'){m.loadmsgMode=='replace'&&k.empty();k.append(m.loadmsgElm)}}}return i}},F=function(a){if(!a[s]()){var h=this,n=d(h).data(l+'Elm')||this;bfloadEv=B['load'].call(n,h);bfloadEv.isPropagationStopped()&&a[p]();!bfloadEv.passThrough&&a.preventDefault()}},v=d.fn[l]=function(a,h){var n=typeof a=='string';if(n){var r=B[a];r&&this.each(function(){r.apply(this,[].concat(h))})}else{a=d.extend({loadmsgMode:'none'},a||{});h&&(a.url=h);var j=this,b=a.loadmsgElm||'<div class="loading" />',c=(v.i18n[j.closest('*[lang]').attr('lang')]||{}).loading||v.i18n.en.loading;if(b.charAt){b=b.replace(/%\{msg\}/g,c)}b=a.loadmsgElm=d(b);if(!b.text()){b.append(c)}j.data(l,{cfg:a});a.onLoad&&j.bind(y,a.onLoad);a.onLoaded&&j.bind(z,a.onLoaded);a.onBeforeload&&j.bind(x,a.onBeforeload);a.params=typeof a.params=='string'?a.params:d.param(a.params||{});a.url&&j[l]('load',a.url)}return this};v.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);
