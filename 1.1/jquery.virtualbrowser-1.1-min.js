// encoding: utf-8
// $.fn.virtualBrowser 1.1  -- (c) 2010 Hugsmiðjan ehf. 
(function(c,n){c.injectBaseHrefToHtml=function(a,g){var b=g.split('#')[0],d=b[i](/([^?]*\/)?(.*)/,'$2'),e=b.split('?')[0][i](/(.*\/)?.*/,'$1');a=a[i](/(<[^>]+ (href|src|action)=["'])(["'#])/gi,'$1'+d+'$3')[i](/(<[^>]+ (href|src|action)=["'])\?/gi,'$1'+d.split('?')[0]+'?')[i](/(["'])([a-z]{3,12}:)/gi,'$1`<<`>>$2')[i](/(<[^>]+ (href|src|action)=["'])([^\/`])/gi,'$1'+e+'$3')[i](/\`<<`>>/g,'');return a};c.getResultBody=function(a){return c('<div/>').append(c(a||[]).not('script,title,meta,link,style').find('script,style').remove().end())};var u=document.location,q='isDefaultPrevented',o='stopPropagation',l='passThrough',m='virtualBrowser',v='VBbeforeload',w='VBload',x='VBloaded',i='replace',y=/^(https?:)?\/\//,z={'load':function(b){var d=typeof b!='string'?c(b):n,e=c(this),h=e.data(m),j=h.cfg,k=c.Event(v),p,r,A=j.loadmsgMode,f=h.lastRequest={elm:d};if(d){b=d.attr('href');b=b===n?d.attr('action'):b}b=f.url=b===''?u.href:b;if(b){k[o]();e.trigger(k,f);if(!k[l]&&((k[l]===n&&d&&d[0].target&&d[0].target!=window.name)||(/^([a-z]{3,12}:|\/\/)/i.test(b)&&!b.toLowerCase()[i](y,'').indexOf(u.href.toLowerCase()[i](y,'').split('/')[0])==0))){k[l]=true}k[l]&&k.preventDefault();if(!k[q]()){var s=j.params,B=f.noCache,C;if(d&&d.is('form')){s=d.serialize()+'&'+s;C=d.attr('method')||'GET'}c.ajax({url:f.url.split('#')[0],data:s,type:C,cache:B!==n?B:!j.noCache,complete:function(a,g){f.result=c.injectBaseHrefToHtml(a.responseText,f.url);f.xhr=a;f.status=g;p=c.Event(w);p[o]();e.trigger(p,f);if(!p[q]()){r=c.Event(x);r[o]();j.loadmsgElm.detach();e.empty().append(f.resultDOM||c.getResultBody(f.result)[0].childNodes).trigger(r,{url:f.url,elm:f.elm})}}});if(A&&A!='none'){j.loadmsgMode=='replace'&&e.empty();e.append(j.loadmsgElm)}}}return k},'data':function(){return c(this).data(m)}},D=function(a){var g=c(a.target).closest(a.type=='click'?'[href]':'form');if(g[0]){if(!a[q]()){var b=z['load'].call(this,g);b.isPropagationStopped()&&a[o]();!b[l]&&a.preventDefault()}}},t=c.fn[m]=function(a,g){var b=typeof a=='string';if(b){var d=z[a];d&&this.each(function(){d.apply(this,[].concat(g))})}else{a=c.extend({loadmsgMode:'none'},a||{});g&&(a.url=g);var e=this,h=a.loadmsgElm||'<div class="loading" />',j=(t.i18n[e.closest('*[lang]').attr('lang')]||{}).loading||t.i18n.en.loading;if(h.charAt){h=h.replace(/%\{msg\}/g,j)}h=a.loadmsgElm=c(h);if(!h.text()){h.append(j)}e.data(m,{cfg:a}).bind('click submit',D);a.onLoad&&e.bind(w,a.onLoad);a.onLoaded&&e.bind(x,a.onLoaded);a.onBeforeload&&e.bind(v,a.onBeforeload);a.params=typeof a.params=='string'?a.params:c.param(a.params||{});a.url&&e[m]('load',a.url)}return this};t.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);
