// encoding: utf-8
// jQuery.fn.virtualBrowser 1.1 - MIT/GPL Licensed - More info: http://github.com/maranomynet/virtualbrowser/
(function(d,o){d.injectBaseHrefToHtml=function(f,g){var a=g.split('#')[0],e=a[k](/([^?]*\/)?(.*)/,'$2'),b=a.split('?')[0][k](/(.*\/)?.*/,'$1');f=f[k](/(<[^>]+ (href|src|action)=["'])(["'#])/gi,'$1'+e+'$3')[k](/(<[^>]+ (href|src|action)=["'])\?/gi,'$1'+e.split('?')[0]+'?')[k](/(["'])([a-z]{3,12}:)/gi,'$1`<<`>>$2')[k](/(<[^>]+ (href|src|action)=["'])([^\/`])/gi,'$1'+b+'$3')[k](/\`<<`>>/g,'');return f};d.getResultBody=function(f){return d('<div/>').append(d(f||[]).not('script,title,meta,link,style').find('script,style').remove().end())};var v=document.location,u='isDefaultPrevented',w='preventDefault',r='stopPropagation',p='passThrough',n='virtualBrowser',x='VBbeforeload',y='VBload',z='VBloaded',k='replace',A=/^(https?:)?\/\//,B={'load':function(a){var e=typeof a!='string'?d(a):o,b=d(this),j=b.data(n),h=j.cfg,i=d.Event(x),l,m,C=h.loadmsgMode,c={elm:e};if(j.$$empty){c.isFirst=true;delete j.$$empty}if(e){a=e.attr('href');a=a===o?e.attr('action'):a}a=c.url=a===''?v.href:a;if(a){i[r]();b.trigger(i,c);if(!i[p]&&((i[p]===o&&e&&e[0].target&&e[0].target!=window.name)||(/^([a-z]{3,12}:|\/\/)/i.test(a)&&!a.toLowerCase()[k](A,'').indexOf(v.href.toLowerCase()[k](A,'').split('/')[0])==0))){i[p]=true}i[p]&&i[w]();if(!i[u]()){var E=c.noCache=c.noCache!==o?c.noCache:h.noCache,s=h.params||'',t='GET';if(e&&e.is('form')){t=e.attr('method')||t;s+='&'+e.serialize();var D=j._0;if(D){s+='&'+d.param(D);delete j._0}}c.params=s;c.method=t;d.ajax({url:c.url.split('#')[0],data:s,type:t,cache:!E,complete:function(f,g){c.result=d.injectBaseHrefToHtml(f.responseText,c.url);c.xhr=f;c.status=g;l=d.Event(y);l[r]();b.trigger(l,c);if(!l[u]()){m=d.Event(z);m[r]();h.loadmsgElm.detach();c.resultDOM=c.resultDOM||d.getResultBody(c.result).contents();b.empty().append(c.resultDOM);j.lastRequest=c;b.trigger(m,c);delete c.resultDOM;delete c.result;delete c.xhr}}});if(C&&C!='none'){h.loadmsgMode=='replace'&&b.empty();b.append(h.loadmsgElm)}}}return i},'data':function(){return d(this).data(n)}},F=function(f){var g=d(f.target).closest(f.type=='click'?'[href], input:submit, button:submit':'form');if(g[0]){if(!f[u]()){if(!g.is(':submit')){var a=B['load'].call(this,g);if(!a[p]){f[w]();a.isPropagationStopped()&&f[r]()}}else if(g.is('[name]')){var e=d(this).data(n);e._0=g;setTimeout(function(){delete e._0},0)}}}},q=d.fn[n]=function(b,j){var h=this,i=typeof b=='string';if(i){var l=B[b],m;if(l){h.each(function(f){var g=l.apply(this,[].concat(j));if(!f){m=g}})}if(m!==o){return m}}else{h.each(function(){var f=d(this),g=d.extend({},q.defaults,b);j&&(g.url=j);var a=g.loadmsgElm||'<div class="loading" />',e=(q.i18n[f.closest('*[lang]').attr('lang')]||{}).loading||q.i18n.en.loading;if(a.charAt){a=a.replace(/%\{msg\}/g,e)}a=g.loadmsgElm=d(a);if(!a.text()){a.append(e)}f.data(n,{cfg:g,$$empty:1})}).bind('click submit',F);b.onLoad&&h.bind(y,b.onLoad);b.onLoaded&&h.bind(z,b.onLoaded);b.onBeforeload&&h.bind(x,b.onBeforeload);b.params=typeof b.params=='string'?b.params:d.param(b.params||{});b.url&&h[n]('load',b.url)}return this};q.defaults={loadmsgMode:'none'};q.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);
